services:
  # 1) bestaand: ingest API
  - type: web
    name: MT5worker
    env: docker
    plan: starter
    branch: main
    healthCheckPath: /health
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: INGEST_TOKEN
        sync: false
      - key: TZ
        value: Europe/Amsterdam

  # 2) nieuws-collector (dagelijks 21:45 A'dam → 01:00–07:00 volgende dag)
  - type: worker
    name: news-collector
    env: python
    plan: starter
    buildCommand: pip install -r requirements.txt
    startCommand: python app/news_collector.py
    schedule: "45 21 * * *"
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: TZ
        value: Europe/Amsterdam

  # 3) aggregator (dagelijks 02:15 A'dam)
  - type: worker
    name: aggregator
    env: python
    plan: starter
    buildCommand: pip install -r requirements.txt
    startCommand: python app/aggregator.py
    schedule: "15 2 * * *"
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: TZ
        value: Europe/Amsterdam
